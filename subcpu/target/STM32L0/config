#
# Copyright (c) 2018,2019 zhtlab
#
# Permission is hereby granted, free of charge, to any person obtaining
# a copy of this software and associated documentation files
# (the "Software"), to deal in the Software without restriction, including
# without limitation the rights to use, copy, modify, merge, publish,
# distribute, sublicense, and/or sell copies of the Software, and to permit
# persons to whom the Software is furnished to do so, subject to
# the following conditions:
#
# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
# DEALINGS IN THE SOFTWARE.
#

#
# config
#


TARGETCHIP                      = STM32L0XXX

CONFIG_CHIP_ID                  = 0x447

#LITTLE_ENDIAN                  = 1
#BIG_ENDIAN                     = 0

CONFIG_CLOCK_HSE                = 40000000      # unit: Hz
CONFIG_CLOCK_FREQ_EXT_CRYSTAL   = 32000000      # unit: Hz

CONFIG_CLOCK_FREQ_16MHZ         = 16000000     # unit: Hz
CONFIG_CLOCK_FREQ_32MHZ         = 32000000     # unit: Hz
CONFIG_CLOCK_FREQ_DEFAULT       = CONFIG_CLOCK_FREQ_16MHZ
CONFIG_CLOCK_FREQ_SYSCLK_BOOT1  = CONFIG_CLOCK_FREQ_DEFAULT
CONFIG_CLOCK_FREQ_SYSCLK_BOOT2  = CONFIG_CLOCK_FREQ_DEFAULT
CONFIG_CLOCK_FREQ_CPU           = 32000000      # unit: Hz
CONFIG_CLOCK_FREQ_PERI          = 32000000      # unit: Hz
CONFIG_CLOCK_FREQ_SUB           = 0


CONFIG_INTERRUPT_TABLE_ON_RAM   = 1
CONFIG_INTERRUPT_TABLE_LENGTH   = 0x100


###############################
# system information
CONFIG_POWER_SW_PORTNUM                 = 0     # ROW 1  KICADKEY
CONFIG_POWER_SW_BITNUM                  = 1
#CONFIG_POWER_SW_PORTNUM                 = 3     # REF_STM32L4 board
#CONFIG_POWER_SW_BITNUM                  = 2
CONFIG_UPDATE_LED_PORTNUM               = 1
CONFIG_UPDATE_LED_BITNUM                = 14
CONFIG_POWER_LED_PORTNUM                = 1
CONFIG_POWER_LED_BITNUM                 = 15
CONFIG_COL1_PORTNUM                     = 1     # COL 1
CONFIG_COL1_BITNUM                      = 4


### memory info
CONFIG_MEMORY_ROM_BASE			= 0x08000000
CONFIG_MEMORY_ROM_SIZE			= 0x00005000
CONFIG_MEMORY_ROM_ERASE_PAGESIZE	= 0x0080
CONFIG_MEMORY_RAM_BASE			= 0x20000000
CONFIG_MEMORY_RAM_SIZE			= 0x00004000

CONFIG_MEMORY_ROM_EEPROM_BASE           = 0x08080000
CONFIG_MEMORY_ROM_EEPROM_SIZE           = 0x0800
CONFIG_MEMORY_ROM_EEPROM2_BASE          = 0x08080800
CONFIG_MEMORY_ROM_EEPROM2_SIZE          = 0x1000


### binary map
CONFIG_MEMORY_ROM_BOOT1_START		= ((CONFIG_MEMORY_ROM_BASE)+0x00000)
CONFIG_MEMORY_ROM_BOOT1_END		= ((CONFIG_MEMORY_ROM_BASE)+0x007ff)
CONFIG_MEMORY_ROM_BOOT1_SIZE		= ((CONFIG_MEMORY_ROM_BOOT1_END)-(MEMORY_ROM_BOOT1_START)+1)

CONFIG_MEMORY_ROM_BOOT2_START		= ((CONFIG_MEMORY_ROM_BASE)+0x00800)
CONFIG_MEMORY_ROM_BOOT2_END		= ((CONFIG_MEMORY_ROM_BASE)+0x027ff)
CONFIG_MEMORY_ROM_BOOT2_SIZE		= ((CONFIG_MEMORY_ROM_BOOT2_END)-(CONFIG_MEMORY_ROM_BOOT2_START)+1)
CONFIG_MEMORY_ROM_BOOT2_OFFSET		= -0x17fff800	# ((CONFIG_MEMORY_ROM_BOOT2_START)-(CONFIG_MEMORY_RAM_BOOT2_START))

CONFIG_MEMORY_ROM_BOOTLOADER_START	=  CONFIG_MEMORY_ROM_BOOT1_START
CONFIG_MEMORY_ROM_BOOTLOADER_END	=  CONFIG_MEMORY_ROM_BOOT2_END
CONFIG_MEMORY_ROM_BOOTLOADER_SIZE	= ((CONFIG_MEMORY_ROM_BOOTLOADER_END)-(CONFIG_MEMORY_ROM_BOOTLOADER_START)+1)

CONFIG_MEMORY_ROM_FLASHREG_START	= ((CONFIG_MEMORY_ROM_BASE)+0x07800)
CONFIG_MEMORY_ROM_FLASHREG_END		= ((CONFIG_MEMORY_ROM_BASE)+0x07fff)
CONFIG_MEMORY_ROM_FLASHREG_SIZE		= ((CONFIG_MEMORY_ROM_FLASHREG_END)-(CONFIG_MEMORY_ROM_FLASHREG_START)+1)

CONFIG_MEMORY_ROM_MAINFIRM_START	= ((CONFIG_MEMORY_ROM_BASE)+0x4000)
CONFIG_MEMORY_ROM_MAINFIRM_END		= ((CONFIG_MEMORY_ROM_BASE)+0xfffff)	# depends on the chip
CONFIG_MEMORY_ROM_MAINFIRM_SIZE		= ((CONFIG_MEMORY_ROM_MAINFIRM_END)-(CONFIG_MEMORY_ROM_MAINFIRM_START)+1)

CONFIG_MEMORY_RAM_BOOT2_START		= ((CONFIG_MEMORY_RAM_BASE))
CONFIG_MEMORY_RAM_BOOT2_END		= ((CONFIG_MEMORY_RAM_BASE)+(CONFIG_MEMORY_ROM_BOOT2_SIZE)-1)
CONFIG_MEMORY_RAM_BOOT2_SIZE		=  (CONFIG_MEMORY_ROM_BOOT2_SIZE)

CONFIG_MEMORY_MAINFIRM_START		= 0x08004000
CONFIG_MEMORY_MAINFIRM_END		= 0x08027fff	# depends on the chip
CONFIG_MEMORY_MAINFIRM_SIZE		= ((CONFIG_MEMORY_MAINFIRM_END)-(CONFIG_MEMORY_MAINFIRM_START)+1)

CONFIG_MEMORY_KEYMAP                    = (CONFIG_MEMORY_ROM_EEPROM_BASE)

CONFIG_MCO_ENABLE                       = 0


###############################
# bootloader
CONFIG_BOOTLOADER_CMD_VERSION           = 0x31
CONFIG_BOOTLOADER_PERI_I2C_ADDR         = 0x18
CONFIG_BOOTLOADER_LED_INDICATE_EN       = 1
CONFIG_BOOTLOADER_ALIVE_TIME            = (300) # in seconds
CONFIG_BOOTLOADER_SW_REBBOT_TIME        = 5
CONFIG_BOOTLOADER_CHECK_SW              = 1

CONFIG_BOOTLOADER_VERSION_PTR           = ((MEMORY_BOOT1_START)+0x20)
CONFIG_BOOTLOADER_TOP			= ((CONFIG_MEMORY_ROM_BOOTLOADER_START))
CONFIG_BOOTLOADER_INFO_TOP              = ((CONFIG_BOOTLOADER_TOP)+0x410)
CONFIG_BOOTLOADER_INFO_BOTTOM           = ((CONFIG_BOOTLOADER_TOP)+0x41f)
CONFIG_BOOTLOADER_INFO_CRC_POS          = ((CONFIG_BOOTLOADER_INFO_TOP)+0x0)
CONFIG_BOOTLOADER_INFO_SIZE_POS         = ((CONFIG_BOOTLOADER_INFO_TOP)+0x4)
CONFIG_BOOTLOADER_INFO_ENTRY_POS        = ((CONFIG_BOOTLOADER_INFO_TOP)+0x8)
CONFIG_BOOTLOADER_INFO_VERSION_POS      = ((CONFIG_BOOTLOADER_INFO_TOP)+0xc)
CONFIG_BOOTLOADER_TEXT_TOP              = ((CONFIG_BOOTLOADER_TOP)+0x420)

# crc, bootloader version number
CONFIG_BOOTLOADER_CMD_EXTENTIONS_ENABLE = 1


###############################
# firmware
CONFIG_FIRMWARE_TOP			= ((CONFIG_MEMORY_MAINFIRM_START))
CONFIG_FIRMWARE_VECTOR_TOP		= ((CONFIG_FIRMWARE_TOP)+0x000)
CONFIG_FIRMWARE_VECTOR_BOTTOM		= ((CONFIG_FIRMWARE_TOP)+0x0ff)
CONFIG_FIRMWARE_SYSTEMINFO_TOP		= ((CONFIG_FIRMWARE_TOP)+0x400)
CONFIG_FIRMWARE_SYSTEMINFO_BOTTOM	= ((CONFIG_FIRMWARE_TOP)+0x40f)
CONFIG_FIRMWARE_INFO_TOP		= ((CONFIG_FIRMWARE_TOP)+0x410)
CONFIG_FIRMWARE_INFO_BOTTOM		= ((CONFIG_FIRMWARE_TOP)+0x41f)
CONFIG_FIRMWARE_INFO_CRC_POS		= ((CONFIG_FIRMWARE_INFO_TOP)+0x0)
CONFIG_FIRMWARE_INFO_SIZE_POS		= ((CONFIG_FIRMWARE_INFO_TOP)+0x4)
CONFIG_FIRMWARE_INFO_ENTRY_POS		= ((CONFIG_FIRMWARE_INFO_TOP)+0x8)
CONFIG_FIRMWARE_INFO_VERSION_POS	= ((CONFIG_FIRMWARE_INFO_TOP)+0xc)
CONFIG_FIRMWARE_TEXT_TOP		= ((CONFIG_FIRMWARE_TOP)+0x420)

CONFIG_FIRMWARE_INFO_TOP_MK		= 0x08004410

###############################
### firmupdate, bootloader
CONFIG_FIRMUPDATE_POWERSW_TIMEOUT       = (1000)
CONFIG_FIRMUPDATE_POWERLED_BLINK_SLOW   = (0x400)
CONFIG_FIRMUPDATE_POWERLED_BLINK_FAST   = (0x100)
CONFIG_FIRMUPDATE_POWERLED_BLINK_TIME   = (800)         # in msec


###############################
### rtos
CONFIG_USE_RTOS                         = 1


###############################
### crc32
DYNAMIC_CRC_TABLE                       = 1


__CHECK_DEVICE_DEFINES                  = 1


##############################
### USART
CONFIG_SYSTEM_USART_PORT                = 1
CONFIG_SYSTEM_USART_BAUD                = 115200
CONFIG_CONSOLE_NUMBER                   = (CONFIG_SYSTEM_USART_PORT)


###############################
### USB

CONFIG_AUDIO_FS_96K000                           = 96000
CONFIG_AUDIO_FS_48K000                           = 48000
CONFIG_AUDIO_FS_44K100                           = 44100
CONFIG_AUDIO_FS_32K000                           = 32000
CONFIG_AUDIO_FS_16K000                           = 16000

CONFIG_USB_MAXNUM_DEVICES                        = 1
CONFIG_USB_MAXNUM_CONFIGURATIONS                 = 1
CONFIG_USB_MAXNUM_INTERFACES                     = 9
CONFIG_USB_MAXNUM_REGCLASSES                     = 4

### USB AUDIO terminarl definitions
CONFIG_USB_AUDIO_200_ENABLE                     = 1

CONFIG_USB_AUDIO_TERM_STREAMIN                  = 1
CONFIG_USB_AUDIO_TERM_SPOUT                     = 2
CONFIG_USB_AUDIO_TERM_SPVOLUME                  = 3
CONFIG_USB_AUDIO_TERM_MICIN                     = 4
CONFIG_USB_AUDIO_TERM_STREAMOUT                 = 5

CONFIG_USB_AUDIO_TERM_CLK_SOURCE_SP             = 16
CONFIG_USB_AUDIO_TERM_CLK_SELECTOR_SP           = 17
CONFIG_USB_AUDIO_TERM_CLK_SOURCE_MIC            = 18
CONFIG_USB_AUDIO_TERM_CLK_SELECTOR_MIC          = 19


### KEYs
CONFIG_KEY_ROW_CNT                              = 7
CONFIG_KEY_COL_CNT                              = 5
